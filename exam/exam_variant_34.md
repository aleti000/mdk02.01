# Экзамен МДК 02.01 - Вариант 34

## Описание
Для сдачи экзамена необходимо настроить сеть из трех машин: ISP (маршрутизатор), Server (сервер) и cli (клиент). Все машины должны работать корректно вместе.

## Схема сети
- ISP: сервер маршрутизации и DHCP
- Server: файловый сервер с RAID, Samba DC, NFS
- cli: клиентская машина для доступа к сервисам
- Все машины подключены в локальную сеть

## Задание

### I. Настройка сетевого взаимодействия (на сервере ISP)
**Цель:** Настроить базовое сетевое взаимодействие и DHCP для внутренней сети.

**A. Настройка внутреннего IP адреса**  
Назначьте интерфейсу внутренней сети первый доступный IP адрес из подсети 10.0.161.0/24 (т.е. 10.0.161.1).  

*Проверка:*  
```
ip addr show
```
Должен отображаться IP 10.0.161.1 на соответствующем интерфейсе.

**B. Настройка iptables для выхода в интернет**  
Установите iptables и настройте правила для NAT (маскарадинга) на внешнем интерфейсе, чтобы машины внутренней сети могли выходить в интернет.  

*Проверка:*  
```
iptables -t nat -L
sudo iptables -L
```
Должны быть правила MASQUERADE и разрешающий трафик.

**C. Настройка DHCP сервера**  
Установите и настройте DHCP сервер для автоматического назначения IP адресов.  

*1. Статический адрес для Server:* Второй свободный адрес подсети (10.0.161.2)  

*2. Динамический пул:* Адреса с 10.0.161.116 по 10.0.161.100  

*Проверка:*  
```
cat /etc/dhcp/dhcpd.conf
systemctl status isc-dhcp-server
```
Конфигурация должна содержать соответствующие диапазоны и резервирование для Server.

### II. Настройка сетевого каталога (на сервере Server)
**Цель:** Создать отказоустойчивый RAID массив и опубликовать его по сети.

**A. Создание RAID-0**  
На дисках sdb, sdc, sdd создайте RAID-0 массив.  

*Проверка:*  
```
cat /proc/mdstat
mdadm --detail /dev/md0
```

**B. Монтирование массива**  
Смонтируйте RAID в каталог /mnt/raid_34  

*Проверка:*  
```
df -h | grep raid_1
mount | grep raid_1
```

**C. Публикация через NFS**  
Опубликуйте /mnt/raid_34 как общедоступный NFS каталог.  

*Проверка:*  
```
cat /etc/exports
systemctl status nfs-server
showmount -e localhost
```

**D. Монтирование на клиенте cli**  
На машине cli примонтируйте сетевой каталог в /share_34  

*Проверка:* (на cli)  
```
df -h | grep share_1
mount | grep share_1
```

### III. Настройка удаленного доступа
**Цель:** Настроить SSH доступ между машинами без пароля.

**A. SSH доступ cli ко всем машинам**  
Настройте возможность подключения с cli на ISP и Server по SSH.  

*Проверка:* (с cli)  
```
ssh ISP
ssh Server
```
Должно подключаться без запроса пароля.

**B. Псевдонимы для подключения**  
Настройте алиасы: `ssh ISP` и `ssh Server`  

*Проверка:*  
```
cat ~/.ssh/config
```

**C. Без пароля**  
Используйте ключи SSH для аутентификации.  

*Проверка:* Попытка подключения без ввода пароля.

**D. Нестандартные порты**  
Используйте порт 2234 для SSH подключений.  

*Проверка:*  
```
ssh -p 2234 user@host
```

**E. Пользователь sshuser**  
Создайте пользователя sshuser на всех машинах.  

*Проверка:*  
```
id sshuser
```

### IV. Управление пользователем sshuser
**Цель:** Настроить ограниченные sudo права для sshuser.

**A. Ограниченные права**  
sshuser может выполнять только shutdown, reboot и htop через sudo.  

*Проверка:*  
```
sudo -l -U sshuser
```

**B. Без пароля для sudo**  
Настроить NOPASSWD для разрешенных команд.  

*Проверка:*  
```
sudo -u sshuser htop
```
Должно работать без запроса пароля.

### V. Настройка службы каталогов Samba DC (на Server)
**Цель:** Создать домен и пользователей для аутентификации.

**A. Домен variant34.sa**  
Настройте Samba как контроллер домена с именем variant34.sa.  

*Проверка:*  
```
samba-tool domain info variant34.sa
systemctl status samba
```

**B. Пользователи и группа**  
Создайте пользователей variant34_1, variant34_2, variant34_3 и группу variant34_group.  

*Проверка:*  
```
samba-tool user list
samba-tool group listmembers variant34_group
```

**C. Аутентификация на cli**  
Пользователи домена должны иметь возможность входа на cli.  

*Проверка:* (на cli)  
```
su - variant34_1@variant34.sa
```

**D. Sudo права для группы**  
Пользователи variant34_group имеют те же ограниченные права на cli, что и sshuser.  

*Проверка:*  
```
sudo -l -U variant34_1
```

### VI. Настройка iptables (на ISP)
**Цель:** Настроить фильтрацию трафика.

**A. Запрет транзитного трафика**  
Запретить весь транзитный трафик, кроме:  
- Established и related соединения  
- Порты 80, 443, 53  

*Проверка:*  
```
sudo iptables -L
```
Должны быть соответствующие правила.
