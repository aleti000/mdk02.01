# Лекция 5: Варианты установки Linux

## Цели и задачи
- Изучить различные способы установки Linux.
- Разобраться с типами установки (графическая, текстовая, автоматическая).
- Научиться устанавливать Linux на физическое оборудование и виртуальные машины.
- Понять принципы подготовки носителей для установки.

## Основной материал

---

### 1. Введение в установку Linux

#### Что такое установка Linux?
Установка Linux — это процесс развертывания операционной системы на компьютере или виртуальной машине. Она включает несколько этапов:
1. Подготовка носителя: Создание загрузочного USB-накопителя или CD/DVD с дистрибутивом Linux.
2. Загрузка системы: Запуск установщика с загрузочного носителя.
3. Настройка системы: Разметка диска, создание пользователей, конфигурация сети и других параметров.
4. Установка загрузчика: GRUB или другой загрузчик для запуска системы после установки.

#### Типы установки:
1. Графическая установка:
   - Используется графический интерфейс, удобен для новичков.
   - Подходит для рабочих станций и домашних компьютеров.
   - Пример: Установка ALT Linux через графический мастер установки.
2. Текстовая установка:
   - Выполняется через командную строку.
   - Подходит для серверов, где графический интерфейс не требуется.
   - Пример: Установка Ubuntu Server в текстовом режиме.
3. Автоматическая установка:
   - Используются скрипты (например, Kickstart или Preseed) для автоматизации процесса.
   - Полезно для массового развертывания систем.
   - Пример: Автоматическая установка ALT Linux на сотни серверов с использованием Kickstart.

#### Этапы установки:
1. Выбор носителя: USB, CD/DVD или сетевая установка.
2. Загрузка системы: BIOS/UEFI настраивается для загрузки с выбранного носителя.
3. Разметка диска: Создание разделов (например, /, /home, swap).
4. Настройка системы: Указание имени хоста, часового пояса, пароля root и создания пользователя.
5. Установка загрузчика: GRUB устанавливается на жесткий диск для загрузки системы.

#### Особенности установки:
- Физическое оборудование: Установка на реальный компьютер требует внимательного выбора оборудования (процессор, RAM, диск).
- Виртуальные машины: Установка в средах виртуализации (VirtualBox, KVM, VMware) позволяет экспериментировать без риска повредить основную систему.

---

### 2. Подготовка носителей для установки

#### Создание загрузочного USB-накопителя:
1. Скачивание ISO-образа:
   - Перейдите на официальный сайт дистрибутива (например, ALT Linux или Ubuntu) и скачайте ISO-образ.
   - Убедитесь, что образ подходит для вашей архитектуры (x86_64, ARM и т.д.).
2. Проверка целостности образа:
   - Каждый ISO-образ имеет контрольную сумму (SHA256 или MD5), которая проверяет его целостность.
   - Для проверки используйте команду:
     sha256sum /path/to/image.iso
     Сравните результат с контрольной суммой на сайте дистрибутива.
3. Запись образа на USB:
   - Используйте утилиту dd для записи образа на USB-накопитель:
     dd if=/path/to/image.iso of=/dev/sdX bs=4M status=progress
     Здесь /dev/sdX — устройство USB-накопителя (например, /dev/sdb).
   - Альтернативные инструменты:
     - Etcher: Графическая программа для записи образов.
     - Rufus: Популярная утилита для Windows.

#### Создание загрузочного CD/DVD:
1. Запись образа на диск:
   - Используйте программу для записи дисков (например, Brasero, Nero или CDBurnerXP).
   - Выберите ISO-образ и запишите его на диск.
2. Проверка загрузочного диска:
   - Вставьте диск в привод и перезагрузите компьютер.
   - Убедитесь, что система загружается с диска.

#### Подготовка сетевой установки:
Сетевая установка Linux позволяет загружать операционную систему и устанавливать её по сети. Это особенно полезно для массового развертывания систем в корпоративных средах или лабораториях.

##### Принципы сетевой установки:
1. PXE (Preboot Execution Environment):
   - PXE — это протокол, который позволяет компьютеру загружаться по сети. Для этого используется комбинация DHCP, TFTP и HTTP/FTP/NFS серверов.
   - Компьютер загружается с сетевого интерфейса, получает IP-адрес от DHCP-сервера и загружает образ ядра и initrd с TFTP-сервера.
2. DHCP-сервер:
   - DHCP-сервер предоставляет клиенту IP-адрес и указывает адрес TFTP-сервера, с которого нужно загрузить файлы.
3. TFTP-сервер:
   - TFTP (Trivial File Transfer Protocol) используется для передачи файлов ядра и initrd.
4. HTTP/FTP/NFS-сервер:
   - После загрузки ядра система монтирует репозиторий с пакетами для установки. Репозиторий может быть размещен на HTTP, FTP или NFS-сервере.

##### Инструменты для сетевой установки:
1. DHCP-сервер:
   - Используется для выдачи IP-адресов и указания параметров загрузки.
   - Пример: dnsmasq или isc-dhcp-server.
2. TFTP-сервер:
   - Используется для хранения и передачи файлов ядра и initrd.
   - Пример: tftpd-hpa.
3. HTTP/FTP/NFS-сервер:
   - Используется для хранения репозитория с пакетами для установки.
   - Пример: apache2, vsftpd, nfs-kernel-server.

##### Последовательность настройки сетевой установки:
1. Настройка DHCP-сервера:
   - Установите DHCP-сервер:
     sudo apt install isc-dhcp-server
   - Настройте конфигурацию в файле /etc/dhcp/dhcpd.conf:
     subnet 192.168.1.0 netmask 255.255.255.0 {
         range 192.168.1.100 192.168.1.200;
         option routers 192.168.1.1;
         option domain-name-servers 8.8.8.8;
         filename "pxelinux.0";
         next-server 192.168.1.10;
     }
     Здесь:
     - filename "pxelinux.0" указывает имя файла для загрузки с TFTP-сервера.
     - next-server 192.168.1.10 указывает адрес TFTP-сервера.
2. Настройка TFTP-сервера:
   - Установите TFTP-сервер:
     sudo apt install tftpd-hpa
   - Настройте директорию для хранения файлов:
     sudo mkdir -p /var/lib/tftpboot
     sudo cp /path/to/pxelinux.0 /var/lib/tftpboot/
     sudo cp /path/to/vmlinuz /var/lib/tftpboot/
     sudo cp /path/to/initrd.img /var/lib/tftpboot/
3. Настройка HTTP/FTP/NFS-сервера:
   - Установите HTTP-сервер (например, Apache):
     sudo apt install apache2
   - Разместите ISO-образ или репозиторий в директории /var/www/html:
     sudo mount -o loop /path/to/image.iso /var/www/html/repo
4. Настройка BIOS/UEFI клиента:
   - Включите загрузку по сети (PXE) в BIOS/UEFI клиента.
   - Перезагрузите клиент, и он автоматически загрузится с сетевого интерфейса.
5. Запуск установки:
   - После загрузки системы с PXE начнется процесс установки Linux.
   - Выберите параметры установки (например, язык, часовой пояс, пароль root).
   - Укажите адрес репозитория для установки пакетов.

##### Пример команд для проверки работы:
1. Проверьте статус DHCP-сервера:
   systemctl status isc-dhcp-server
2. Проверьте доступность TFTP-сервера:
   tftp 192.168.1.10
   get pxelinux.0
3. Проверьте доступность HTTP-сервера:
   curl http://192.168.1.10/repo

##### Особенности сетевой установки ALT Linux:
- ALT Linux предоставляет готовые скрипты и инструкции для настройки PXE-сервера.
- Репозитории ALT Linux можно использовать как источник пакетов для установки.

---

### 3. Установка на физическое оборудование

#### Шаги установки:
1. Загрузка с носителя:
   - Перезагрузите компьютер.
   - Выберите загрузку с USB или CD/DVD в BIOS/UEFI.
2. Выбор типа установки:
   - Графическая установка: Нажмите "Install" в меню загрузки.
   - Текстовая установка: Выберите режим "Text mode".
3. Разметка диска:
   - Автоматическая разметка: Система сама создаст разделы.
   - Ручная разметка: Используйте инструменты (fdisk, parted) для создания разделов.
4. Настройка системы:
   - Укажите имя хоста, часовой пояс и пароль root.
   - Создайте пользователя.
5. Установка загрузчика:
   - GRUB устанавливается автоматически на жесткий диск.

#### Пример:
Установите ALT Linux на физический компьютер:
1. Загрузитесь с USB-накопителя.
2. Выберите "Install ALT Linux".
3. Разметьте диск:
   fdisk /dev/sda
4. Завершите установку и перезагрузите систему.

---

### 4. Установка на виртуальную машину

#### Преимущества виртуальных машин:
- Изоляция: Виртуальная машина полностью изолирована от основной системы.
- Бэкапы: Возможность создавать снимки (snapshots) для восстановления состояния.
- Эксперименты: Безопасное тестирование новых программ и настроек.

#### Инструменты для виртуализации:
1. VirtualBox:
   - Бесплатный гипервизор для домашнего использования.
   - Поддерживает создание виртуальных машин на Windows, macOS и Linux.
2. KVM:
   - Встроенная в Linux система виртуализации.
   - Требует аппаратной поддержки виртуализации (Intel VT-x или AMD-V).
3. VMware:
   - Профессиональный инструмент для корпоративных сред.
   - Предлагает больше возможностей, чем VirtualBox, но является платным.

#### Шаги установки:
1. Создание виртуальной машины:
   - Откройте VirtualBox или другой гипервизор.
   - Нажмите "Создать" и укажите параметры:
     - Имя виртуальной машины.
     - Тип операционной системы (Linux).
     - Версия (например, Ubuntu 64-bit).
     - Объем RAM (рекомендуется минимум 2 ГБ).
     - Размер жесткого диска (рекомендуется минимум 20 ГБ).
2. Настройка носителя:
   - Выберите ISO-образ как источник установки.
   - Убедитесь, что виртуальная машина настроена на загрузку с ISO.
3. Запуск установки:
   - Запустите виртуальную машину.
   - Следуйте шагам установки, как на физическом оборудовании.
4. Настройка сети:
   - Настройте сетевой адаптер виртуальной машины:
     - NAT: Для доступа к интернету через основную систему.
     - Bridge: Для работы в локальной сети как отдельный компьютер.

#### Пример установки в VirtualBox:
1. Создайте новую виртуальную машину:
   vboxmanage createvm --name "ALT_Linux" --register
   vboxmanage modifyvm "ALT_Linux" --memory 2048 --cpus 2
   vboxmanage createhd --filename "ALT_Linux.vdi" --size 20000
   vboxmanage storagectl "ALT_Linux" --name "SATA Controller" --add sata
   vboxmanage storageattach "ALT_Linux" --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium "ALT_Linux.vdi"
   vboxmanage storageattach "ALT_Linux" --storagectl "SATA Controller" --port 1 --device 0 --type dvddrive --medium /path/to/image.iso
2. Запустите виртуальную машину:
   vboxmanage startvm "ALT_Linux"

#### Особенности установки в KVM:
1. Создайте новую виртуальную машину:
   virt-install --name=ALT_Linux --ram=2048 --vcpus=2 --disk path=/var/lib/libvirt/images/ALT_Linux.qcow2,size=20 --cdrom /path/to/image.iso --os-type linux --os-variant altlinux
2. Управляйте виртуальной машиной через virt-manager или командную строку.

---

### 5. Автоматическая установка

#### Kickstart (для Red Hat-based систем):
Kickstart позволяет автоматизировать установку Linux с помощью файла конфигурации.

#### Пример файла Kickstart:
install
url --url=http://mirror.altlinux.org/repository/
lang en_US.UTF-8
keyboard us
network --bootproto=dhcp
rootpw password
firewall --disabled
authconfig --enableshadow --passalgo=sha512
timezone UTC
bootloader --location=mbr
clearpart --all --initlabel
part / --fstype=ext4 --size=10000
part swap --size=2048
reboot
#### Preseed (для Debian-based систем):
Preseed используется для автоматической установки Debian и Ubuntu.

#### Пример файла Preseed:
d-i debian-installer/locale string en_US
d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/layoutcode string us
d-i netcfg/choose_interface select auto
d-i passwd/root-password password rootpassword
d-i passwd/user-fullname string User Name
d-i passwd/username string user
d-i passwd/user-password password userpassword
tasksel tasksel/first multiselect standard, ssh-server
d-i finish-install/reboot_in_progress note

#### Запуск автоматической установки:
1. Передайте файл конфигурации при загрузке:
linux ks=http://example.com/ks.cfg
2. Система автоматически выполнит установку.

---

### 6. Особенности установки ALT Linux

#### Преимущества ALT Linux:
- Интеграция с отечественными стандартами.
- Поддержка российского ПО (1С, КриптоПро).
- Стабильность и безопасность.

#### Особенности установки:
1. Выбор репозитория:
- Укажите ближайший зеркало ALT Linux.
2. Настройка локализации:
- Выберите язык, раскладку клавиатуры и часовой пояс.
3. Установка дополнительного ПО:
- ALT Linux предлагает предустановленные пакеты для серверов и рабочих станций.

---

## Домашнее задание
1. Создайте загрузочный USB-накопитель с ALT Linux.
2. Установите ALT Linux на виртуальную машину.
3. Настройте автоматическую установку с использованием Kickstart или Preseed.
4. Изучите особенности установки ALT Linux.

## Вопросы для самопроверки
1. Какие типы установки Linux существуют?
2. Как создать загрузочный USB-накопитель?
3. Как установить Linux на физическое оборудование?
4. Как установить Linux на виртуальную машину?
5. Для чего используются файлы Kickstart и Preseed?
6. Какие особенности имеет установка ALT Linux?
