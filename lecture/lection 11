# Лекция 11: Файловые серверы

## Цели и задачи
- Изучить основные принципы работы файловых серверов.
- Разобраться с ролью Samba и NFS в организации общих ресурсов.
- Научиться устанавливать и настраивать Samba для совместимости с Windows.
- Научиться устанавливать и настраивать NFS для Unix-подобных систем.
- Понять процесс диагностики и устранения неисправностей в работе файловых серверов.

---

## Основной материал

### 1. Введение в файловые серверы

#### Что такое файловый сервер?
Файловый сервер — это система, предоставляющая доступ к файлам для других устройств в сети. Это позволяет пользователям совместно использовать файлы, папки и принтеры.

#### Зачем нужны файловые серверы?
- Централизованное хранение данных.
- Совместный доступ к файлам между пользователями.
- Поддержка различных операционных систем (Windows, Linux, macOS).

#### Основные типы файловых серверов:
1. Samba: Для совместимости с Windows.
2. NFS: Для Unix-подобных систем.

---

### 2. Установка и настройка Samba

#### Что такое Samba?
Samba — это программное обеспечение, которое реализует протокол SMB/CIFS для совместного использования файлов и принтеров между Linux и Windows.

#### Установка Samba
Для установки Samba в Linux используется пакетный менеджер. Например, в Ubuntu:

1. Обновите список пакетов:
   apt update
2. Установите Samba:
   apt install samba

#### Конфигурационный файл
Основной файл конфигурации Samba:
/etc/samba/smb.conf

##### Пример конфигурации:
[global]
   workgroup = WORKGROUP
   server string = Samba Server %v
   security = user

[shared]
   path = /srv/samba/shared
   browsable = yes
   writable = yes
   valid users = sambauser

- [global]: Глобальные настройки сервера.
- [shared]: Имя общего ресурса.
- path: Путь к общей папке.
- browsable: Доступность через сетевое окружение.
- writable: Возможность записи.
- valid users: Список разрешенных пользователей.

#### Создание общего ресурса
1. Создайте директорию:
   mkdir -p /srv/samba/shared
2. Назначьте права доступа:
   chmod 777 /srv/samba/shared
3. Добавьте пользователя Samba:
   smbpasswd -a sambauser

#### Перезапуск службы
После изменения конфигурации перезапустите службу:
systemctl restart smbd

#### Проверка работы
1. Откройте проводник Windows и введите:
   \\server-ip\shared
2. Введите логин и пароль Samba.

---

### 3. Установка и настройка NFS

#### Что такое NFS?
NFS (Network File System) — это протокол для совместного использования файлов между Unix-подобными системами. Он позволяет монтировать удаленные файловые системы как локальные.

#### Установка NFS
Для установки NFS в Linux используется пакетный менеджер. Например, в Ubuntu:

1. Установите сервер NFS:
   apt install nfs-kernel-server
2. Установите клиент NFS:
   apt install nfs-common

#### Конфигурационный файл
Основной файл конфигурации NFS:
/etc/exports

##### Пример конфигурации:
/srv/nfs/shared 192.168.1.0/24(rw,sync,no_subtree_check)

- /srv/nfs/shared: Путь к общей папке.
- 192.168.1.0/24: Сеть, которой разрешен доступ.
- rw: Разрешение на чтение и запись.
- sync: Синхронизация изменений на диск.
- no_subtree_check: Отключение проверки поддерева.

#### Создание общего ресурса
1. Создайте директорию:
   mkdir -p /srv/nfs/shared
2. Назначьте права доступа:
   chmod 777 /srv/nfs/shared

#### Перезапуск службы
После изменения конфигурации перезапустите службу:
systemctl restart nfs-kernel-server

#### Монтирование на клиенте
1. Создайте точку монтирования:
   mkdir -p /mnt/nfs
2. Монтируйте удаленную файловую систему:
   mount server-ip:/srv/nfs/shared /mnt/nfs

---

### 4. Диагностика и устранение неисправностей

#### Проверка работы Samba
1. Проверьте статус службы:
   systemctl status smbd
2. Просмотрите логи:
   tail -f /var/log/samba/log.smbd

#### Проверка работы NFS
1. Проверьте экспортированные ресурсы:
   exportfs -v
2. Проверьте статус службы:
   systemctl status nfs-kernel-server

#### Распространенные проблемы:
- Неправильные права доступа к папкам.
- Ошибки в конфигурационных файлах.
- Блокировка файрволом.

---

### 5. Безопасность файловых серверов

#### Защита Samba
1. Используйте аутентификацию:
   - Настройте параметр security = user.
2. Ограничьте доступ по IP:
   - Укажите разрешенные сети в конфигурации.

#### Защита NFS
1. Используйте файрвол:
   - Разрешите доступ только из доверенных сетей.
2. Настройте права доступа:
   - Убедитесь, что права на папки корректны.

---

## Домашнее задание
1. Установите и настройте Samba на виртуальной машине.
2. Создайте общий ресурс и предоставьте доступ к нему с Windows.
3. Установите и настройте NFS.
4. Монтируйте удаленный ресурс NFS на клиентской машине.
5. Проверьте работу файловых серверов и изучите логи.

---

## Вопросы для самопроверки
1. Что такое файловый сервер и для чего он используется?
2. Как установить и настроить Samba в Linux?
3. Как установить и настроить NFS в Linux?
4. Как проверить работу файловых серверов?
5. Какие меры безопасности можно применить для защиты файловых серверов?
