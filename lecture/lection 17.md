# Лекция 17: Мониторинг и журналирование

## Цели и задачи
- Изучить основные принципы мониторинга и журналирования в Linux.
- Разобраться с инструментами сбора и анализа логов.
- Научиться использовать системные утилиты для мониторинга производительности.
- Понять процесс автоматизации мониторинга с помощью скриптов.
- Изучить инструменты для централизованного сбора и анализа логов.

---

## Основной материал

### 1. Введение в мониторинг и журналирование

#### Что такое мониторинг?
Мониторинг — это процесс наблюдения за состоянием системы, включая использование ресурсов (CPU, память, диск), сетевую активность и работу приложений.

#### Зачем нужен мониторинг?
- Выявление проблем до их критического проявления.
- Анализ производительности системы.
- Обеспечение стабильности работы серверов.

#### Что такое журналирование?
Журналирование — это процесс записи событий системы в логи. Логи помогают анализировать ошибки, отслеживать действия пользователей и диагностировать проблемы.

---

### 2. Системы журналирования

#### Syslog
Syslog — это стандартная система для сбора и хранения логов в Linux. Логи обычно находятся в каталоге /var/log.

Пример просмотра логов:
cat /var/log/syslog

#### Journalctl
journalctl — это утилита для работы с журналами systemd. Она предоставляет удобный интерфейс для просмотра и фильтрации логов.

Просмотр всех логов:
journalctl

Просмотр логов за последние 10 минут:
journalctl --since "10 minutes ago"

Просмотр логов конкретной службы:
journalctl -u ssh.service

---

### 3. Инструменты мониторинга

#### Мониторинг использования ресурсов
Используйте утилиты для мониторинга ресурсов системы:

1. top: Просмотр загрузки CPU и памяти.
2. htop: Улучшенная версия top с удобным интерфейсом.
3. df: Просмотр использования дискового пространства.
4. free: Просмотр использования памяти.

Пример использования:
top
df -h
free -m

#### Мониторинг сетевой активности
Используйте утилиты для анализа сетевого трафика:

1. netstat: Просмотр активных соединений.
2. ss: Современная замена netstat.
3. iftop: Мониторинг сетевого трафика в реальном времени.

Пример использования:
netstat -tuln
ss -tuln
iftop

---

### 4. Централизованный сбор логов

#### Что такое централизованный сбор логов?
Централизованный сбор логов позволяет собирать логи с нескольких серверов в одном месте для анализа.

#### Использование rsyslog
Настройте rsyslog для отправки логов на удаленный сервер.

На клиенте:
*.* @remote-server-ip:514

На сервере:
module(load="imudp")
input(type="imudp" port="514")

Перезапустите службу:
systemctl restart rsyslog

#### Использование ELK-стека
ELK-стек (Elasticsearch, Logstash, Kibana) — это популярное решение для централизованного сбора и анализа логов.

---

### 5. Автоматизация мониторинга

#### Написание скриптов для мониторинга
Создайте скрипт для проверки использования диска:

#!/bin/bash
DISK_USAGE=$(df -h | grep '/dev/sda1' | awk '{print $5}' | sed 's/%//g')

if [ "$DISK_USAGE" -gt 80 ]; then
    echo "Disk usage is above 80%!" | mail -s "Disk Alert" admin@example.com
fi

Сохраните скрипт и сделайте его исполняемым:
chmod +x disk_monitor.sh

Добавьте скрипт в планировщик задач:
crontab -e
0 * * * * /path/to/disk_monitor.sh

---

### 6. Пример мониторинга системы

#### Шаги:
1. Просмотрите логи системы:
   journalctl -u ssh.service
2. Проверьте использование ресурсов:
   top
   df -h
3. Настройте отправку логов на удаленный сервер с помощью rsyslog.
4. Напишите скрипт для мониторинга использования диска.

---

## Домашнее задание
1. Просмотрите логи системы с помощью journalctl.
2. Проверьте использование ресурсов с помощью top и df.
3. Настройте отправку логов на удаленный сервер с помощью rsyslog.
4. Напишите скрипт для мониторинга использования памяти.
5. Изучите логи и найдите записи о подозрительной активности.

---

## Вопросы для самопроверки
1. Что такое мониторинг и журналирование?
2. Как использовать journalctl для просмотра логов?
3. Какие инструменты можно использовать для мониторинга ресурсов?
4. Как настроить централизованный сбор логов?
5. Как автоматизировать мониторинг с помощью скриптов?
