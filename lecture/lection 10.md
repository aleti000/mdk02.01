# Лекция 10: Веб-сервер Nginx

## Цели и задачи
- Изучить основные принципы работы веб-сервера Nginx.
- Разобраться с ролью Nginx в обслуживании веб-сайтов.
- Научиться устанавливать и настраивать Nginx в Linux.
- Понять процесс настройки обратного проксирования.
- Изучить диагностику и устранение неисправностей в работе Nginx.

---

## Основной материал

### 1. Введение в Nginx

#### Что такое Nginx?
Nginx (произносится как "энджин-икс") — это высокопроизводительный веб-сервер, который также может использоваться как:
- Обратный прокси-сервер.
- Балансировщик нагрузки.
- Кэширующий сервер.

Nginx известен своей эффективностью при работе с большим количеством одновременных подключений и низким потреблением ресурсов.

#### Зачем нужен Nginx?
- Обслуживание статических файлов (HTML, CSS, JS, изображения).
- Проксирование запросов к бэкенд-серверам (например, к приложениям на Python, Node.js или PHP).
- Балансировка нагрузки между несколькими серверами.
- Защита от DDoS-атак и других сетевых угроз.

---

### 2. Установка Nginx

#### Установка через пакетный менеджер
Для установки Nginx в Linux используется пакетный менеджер. Например, в Ubuntu:

1. Обновите список пакетов:
   apt update
2. Установите Nginx:
   apt install nginx

#### Проверка установки
1. Проверьте статус службы:
   systemctl status nginx
2. Откройте браузер и перейдите по адресу:
   http://localhost
   - Если установка прошла успешно, вы увидите страницу приветствия Nginx.

---

### 3. Основные конфигурационные файлы

#### Структура конфигурации
Конфигурационные файлы Nginx находятся в каталоге /etc/nginx.

1. Основной файл конфигурации:
   /etc/nginx/nginx.conf
   - Здесь задаются глобальные параметры сервера.

2. Конфигурации сайтов:
   /etc/nginx/sites-available/
   - Каждый сайт имеет отдельный файл конфигурации.

3. Символические ссылки для активных сайтов:
   /etc/nginx/sites-enabled/
   - Активные сайты создаются как символические ссылки из sites-available в sites-enabled.

#### Пример файла конфигурации сайта
```bash
server {
    listen 80;
    server_name example.com www.example.com;

    root /var/www/example.com;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }
}
```

- listen: Порт, на котором работает сервер (обычно 80 для HTTP).
- server_name: Доменное имя сайта.
- root: Корневая директория сайта.
- index: Файл, который будет загружаться по умолчанию.
- location: Блок для обработки запросов.

---

### 4. Настройка обратного проксирования

#### Что такое обратный прокси?
Обратный прокси — это сервер, который принимает запросы от клиентов и перенаправляет их на внутренние серверы (бэкенды). Это позволяет скрыть реальные серверы от внешнего мира и обеспечить балансировку нагрузки.

#### Пример конфигурации обратного проксирования
```bash
server {
    listen 80;
    server_name proxy.example.com;

    location / {
        proxy_pass http://backend_server;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

- proxy_pass: Адрес бэкенд-сервера.
- proxy_set_header: Добавление заголовков для передачи информации о клиенте.

---

### 5. Диагностика и устранение неисправностей

#### Проверка конфигурации
Перед перезапуском Nginx всегда проверяйте корректность конфигурации:
nginx -t

#### Перезапуск службы
Если конфигурация корректна, перезапустите Nginx:
systemctl restart nginx

#### Просмотр логов
Логи Nginx находятся в каталоге /var/log/nginx:
- access.log: Журнал доступа.
- error.log: Журнал ошибок.

Пример просмотра логов:
tail -f /var/log/nginx/error.log

---

### 6. Безопасность Nginx

#### Ограничение доступа
1. Разрешите доступ только к определенным IP-адресам:
```bash
   location /admin {
       allow 192.168.1.0/24;
       deny all;
   }
```

3. Настройте SSL/TLS для шифрования трафика:
```bash
   server {
       listen 443 ssl;
       server_name example.com;

       ssl_certificate /etc/nginx/ssl/example.com.crt;
       ssl_certificate_key /etc/nginx/ssl/example.com.key;

       location / {
           proxy_pass http://backend_server;
       }
   }
```

#### Защита от атак
- Используйте модуль limit_req для ограничения количества запросов:
```bash
  http {
      limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;

      server {
          location / {
              limit_req zone=one burst=5;
          }
      }
  }
```

---

## Домашнее задание
1. Установите и настройте Nginx на виртуальной машине.
2. Создайте конфигурацию для обслуживания статического сайта.
3. Настройте обратный прокси для перенаправления запросов на локальный сервер.
4. Проверьте работу Nginx и изучите логи.

---

## Вопросы для самопроверки
1. Что такое Nginx и для чего он используется?
2. Как установить и настроить Nginx в Linux?
3. Как настроить обратный прокси в Nginx?
4. Как проверить корректность конфигурации Nginx?
5. Какие меры безопасности можно применить для защиты Nginx?
