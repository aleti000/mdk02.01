# Лекция 2: Файловые системы ОС Linux

## Цели и задачи
- Изучить типы файловых систем в Linux.
- Разобраться со структурой файловой системы.
- Научиться работать с файлами и директориями.
- Понять принципы монтирования разделов и управления дисками.

## Основной материал

### 1. Что такое файловая система?
Файловая система — это способ организации и хранения данных на диске. Она определяет, как файлы и директории создаются, хранятся и удаляются.

#### Типы файловых систем в Linux:
- **ext4**: Распространенная файловая система с высокой производительностью.
- **XFS**: Подходит для работы с большими файлами (например, видео).
- **Btrfs**: Продвинутая файловая система с поддержкой снапшотов и сжатия.
- **tmpfs**: Временная файловая система, хранящая данные в оперативной памяти.

Пример:
Чтобы проверить тип файловой системы на ALT Linux, используйте команду:
df -T

### 2. Структура файловой системы Linux
Файловая система Linux организована в виде дерева. Основные директории:
- `/`: Корневая директория.
- `/home`: Домашние директории пользователей.
- `/etc`: Конфигурационные файлы.
- `/var`: Переменные данные (логи, кэш).
- `/usr`: Программы и библиотеки.
- `/dev`: Устройства (диски, принтеры).

Пример:
Чтобы посмотреть содержимое корневой директории, используйте команду:
ls /

### 3. Команды для работы с файлами и директориями
- `ls`: Просмотр содержимого директории.
- `cd`: Переход между директориями.
- `cp`: Копирование файлов.
- `mv`: Перемещение файлов.
- `rm`: Удаление файлов.
- `mkdir`: Создание директории.
- `rmdir`: Удаление пустой директории.

Пример:
Создайте новую директорию и скопируйте в нее файл:
mkdir test_dir
cp /etc/hosts test_dir/

---

### 4. Монтирование разделов: принципы работы
Монтирование — это процесс подключения раздела диска к файловой системе. Без монтирования раздел недоступен для чтения или записи.

#### Как работает монтирование:
1. **Точка монтирования**: Это директория в файловой системе, через которую можно получить доступ к данным на разделе. Например, `/mnt/usb` может быть точкой монтирования для USB-накопителя.
2. **Тип файловой системы**: При монтировании указывается тип файловой системы (например, `ext4`, `vfat` для USB).
3. **Ядро Linux**: Ядро отвечает за взаимодействие с устройствами. Когда вы монтируете раздел, ядро загружает необходимый драйвер для работы с файловой системой.

#### Команда mount:
Команда `mount` используется для подключения раздела:
mount /dev/sdb1 /mnt/usb

#### Автоматическое монтирование:
Для автоматического монтирования разделов используется файл `/etc/fstab`. В нем указываются устройства, точки монтирования и параметры.

Пример строки в `/etc/fstab`:
UUID=1234-5678 /mnt/data ext4 defaults 0 0

---

### 5. Управление дисками
Управление дисками — это важная часть администрирования операционных систем, особенно в Linux. Это включает создание, форматирование и управление разделами жестких дисков, а также их монтирование для использования в системе. Одной из наиболее популярных и мощных утилит для управления дисками в Linux является `parted`. Эта программа позволяет выполнять широкий спектр задач по работе с дисками, начиная от создания новых разделов и заканчивая изменением их размера.

---

### 5.1. Основные понятия управления дисками в Linux

#### 5.1.1. Диск и разделы
- **Диск** — это физическое устройство хранения данных (например, жесткий диск или SSD).
- **Раздел** — это логическая область на диске, которая может быть использована для хранения данных. Разделы позволяют организовать данные на диске более эффективно.

#### 5.1.2. Типы таблиц разделов
### Расширенное описание таблиц разделов: что это, зачем нужна и основные отличия

Таблица разделов — это специальная структура данных, хранящаяся в начале жесткого диска или другого накопителя. Она содержит информацию о логических разделах на физическом устройстве, таких как их расположение, размеры и типы. Таблица разделов необходима для того, чтобы операционная система могла правильно определить, где находятся данные на диске, и как к ним получить доступ.

#### Зачем нужна таблица разделов?

1. **Организация пространства**: Таблица разделов позволяет разбивать диск на несколько логических частей (разделов), каждая из которых может быть использована для разных целей. Например, один раздел можно использовать для операционной системы, другой — для пользовательских данных, третий — для резервных копий.
   
2. **Поддержка различных файловых систем**: Различные разделы могут быть отформатированы под разные файловые системы (например, ext4, NTFS, FAT32). Это особенно важно в многозагрузочных системах, где нужно поддерживать совместимость с несколькими ОС.

3. **Безопасность и изоляция**: Разделы обеспечивают изоляцию данных. Если один раздел поврежден или заражен вирусом, другие разделы могут остаться нетронутыми.

4. **Удобство управления**: Разделы упрощают процесс управления данными, так как каждый раздел можно монтировать, форматировать и управлять отдельно.

---

### Основные типы таблиц разделов

#### 1. **MBR (Master Boot Record)**
MBR — это старый стандарт таблицы разделов, который был разработан в 1983 году для IBM PC. Он является частью первого сектора жесткого диска (первые 512 байт).

##### Преимущества MBR:
- Хорошо подходит для маленьких дисков.
- Широко поддерживается старым оборудованием и программным обеспечением.

##### Недостатки MBR:
- Ограничение по количеству разделов (максимум 4 первичных).
- Ограничение по размеру диска (до 2 ТБ).
- Отсутствие защиты от ошибок и коррупции данных.

---

#### 2. **GPT (GUID Partition Table)**
GPT — это современный стандарт таблицы разделов, который был разработан как часть спецификации UEFI (Unified Extensible Firmware Interface). GPT значительно расширяет возможности MBR.

##### Преимущества GPT:
- Поддержка больших дисков (более 2 ТБ).
- Возможность создания большего количества разделов.
- Защита от ошибок благодаря контрольным суммам и резервному копированию.
- Лучшая совместимость с современными операционными системами и UEFI.

##### Недостатки GPT:
- Не поддерживается старыми операционными системами и BIOS-системами (требуется UEFI).
- Более сложная структура, что может вызвать проблемы при восстановлении данных в случае повреждения.

---

### Как определить текущую таблицу разделов?

Чтобы узнать, какая таблица разделов используется на вашем диске, можно использовать команду `parted`:

```bash
sudo parted /dev/sda print
```

В выводе будет указан тип таблицы разделов (`Partition Table`):
- `msdos` — это MBR.
- `gpt` — это GPT.

---

### Переход от MBR к GPT

Переход от MBR к GPT возможен, но требует осторожности, так как данные могут быть потеряны. Для этого можно использовать инструменты, такие как `gdisk` или `parted`. Однако перед выполнением такой операции обязательно сделайте резервную копию данных.

Пример с помощью `parted`:
```bash
sudo parted /dev/sda mklabel gpt
```

После этого все существующие разделы будут удалены, и потребуется заново создать их.

---

#### 5.1.3. Файловые системы
После создания раздела его необходимо отформатировать под определенную файловую систему (например, ext4, NTFS, FAT32). Файловая система определяет способ организации и хранения данных на разделе.

---

### 5.2. Утилита `parted`

`parted` — это консольная утилита для управления дисками и разделами. Она работает как в интерактивном режиме, так и в командной строке. Поддерживает работу с большими дисками и различными таблицами разделов.

#### 5.2.1. Установка `parted`
На большинстве дистрибутивов Linux `parted` уже предустановлен. Если этого нет, установите его с помощью пакетного менеджера:
```bash
sudo apt install parted   # Для Ubuntu/Debian
sudo yum install parted   # Для CentOS/RHEL
sudo dnf install parted   # Для Fedora
```

---

### 5.3. Базовые команды `parted`

#### 5.3.1. Просмотр информации о дисках
Чтобы получить список доступных дисков и их параметры, используйте команду:
```bash
parted -l
```
Это покажет все диски, их размеры, таблицы разделов и существующие разделы.

#### 5.3.2. Работа с конкретным диском
Чтобы работать с определенным диском, запустите `parted` с указанием имени устройства:
```bash
sudo parted /dev/sda
```
После этого вы войдете в интерактивный режим управления этим диском.

#### 5.3.3. Создание нового раздела
Шаги для создания нового раздела:
1. Просмотрите текущие параметры диска:
   ```bash
   print
   ```
2. Создайте новый раздел:
   ```bash
   mkpart <тип> <начало> <конец>
   ```
   Например:
   ```bash
   mkpart primary ext4 0% 100%
   ```
   Здесь:
   - `primary` — тип раздела (основной или расширенный),
   - `ext4` — файловая система,
   - `0% 100%` — диапазон размеров раздела.

#### 5.3.4. Изменение размера раздела
Чтобы изменить размер существующего раздела:
1. Выберите нужный раздел:
   ```bash
   select /dev/sda
   ```
2. Измените размер:
   ```bash
   resizepart <номер_раздела> <новый_размер>
   ```
   Например:
   ```bash
   resizepart 1 50GB
   ```

#### 5.3.5. Удаление раздела
Чтобы удалить раздел:
```bash
rm <номер_раздела>
```
Например:
```bash
rm 2
```

#### 5.3.6. Настройка таблицы разделов
Чтобы изменить тип таблицы разделов (например, MBR → GPT):
```bash
mklabel gpt
```

#### 5.3.7. Выход из программы
Чтобы завершить работу с `parted`, введите:
```bash
quit
```

---

### 5.4. Пример использования `parted`

#### Задача: Создание нового раздела на диске `/dev/sdb`
1. Откройте терминал и запустите `parted`:
   ```bash
   sudo parted /dev/sdb
   ```
2. Проверьте текущие параметры диска:
   ```bash
   print
   ```
3. Создайте новый раздел:
   ```bash
   mkpart primary ext4 0% 50GB
   ```
4. Проверьте результат:
   ```bash
   print
   ```
5. Выйдите из программы:
   ```bash
   quit
   ```

#### Задача: Форматирование созданного раздела
После создания раздела его необходимо отформатировать:
```bash
sudo mkfs.ext4 /dev/sdb1
```

---

### 6. Заключение

Управление дисками в Linux — это важная задача, требующая внимательности и знания инструментов. Утилита `parted` предоставляет простой и мощный способ работы с дисками и разделами. Мы рассмотрели основные команды для просмотра, создания, изменения и удаления разделов, а также примеры их применения.

Помните, что работа с дисками может привести к потере данных, если выполняется неправильно. Поэтому всегда делайте резервные копии перед выполнением операций с дисками.

Если у вас есть вопросы или возникли сложности, не стесняйтесь обращаться за помощью! 

**Конец лекции.**
### 6. Права доступа: принципы работы
Права доступа в Linux определяют, кто может читать, записывать или выполнять файл.

#### Как работают права:
1. **Три категории прав**:
   - Владелец (user): Пользователь, создавший файл.
   - Группа (group): Группа, которой принадлежит файл.
   - Остальные (others): Все остальные пользователи.
2. **Три типа прав**:
   - `r` (read): Чтение.
   - `w` (write): Запись.
   - `x` (execute): Выполнение.

#### Битовые значения:
Права представлены в виде чисел:
- `r` = 4
- `w` = 2
- `x` = 1

Пример:
Права `755` означают:
- Владелец: `rwx` (7 = 4 + 2 + 1)
- Группа: `r-x` (5 = 4 + 1)
- Остальные: `r-x` (5 = 4 + 1)

#### Команды:
- `chmod`: Изменяет права доступа.
- `chown`: Изменяет владельца файла.
- `chgrp`: Изменяет группу файла.

Пример:
Измените права доступа к файлу:
chmod 755 file.txt

Измените владельца файла:
chown user:group file.txt

#### SUID, SGID и Sticky Bit:
- **SUID**: Разрешает выполнение файла с правами владельца.
- **SGID**: Разрешает выполнение файла с правами группы.
- **Sticky Bit**: Защищает файлы в директории от удаления другими пользователями.

Пример:
Установите Sticky Bit на директорию:
chmod +t /tmp

---

## Домашнее задание
1. Нарисовать схему файловой системы Linux.
2. Создать новую директорию и скопировать в нее файл.
3. Проверить тип файловой системы на вашей системе.
4. Изучить команды chmod и chown.
5. Поэкспериментировать с монтированием разделов и правами доступа.

## Вопросы для самопроверки
1. Какие типы файловых систем используются в Linux?
2. Как устроена файловая система Linux?
3. Какие команды используются для работы с файлами?
4. Как подключить раздел диска к системе?
5. Как изменить права доступа к файлу?
6. Что такое UUID и как его использовать?
7. Как работают SUID, SGID и Sticky Bit?
