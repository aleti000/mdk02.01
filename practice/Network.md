### Лабораторная занятие: Настройка сетевых адаптеров в ALT Linux  
**Цель работы:** Изучить методы настройки сетевых адаптеров в ALT Linux с использованием подсистем `etcnet` и `NetworkManager (nmcli)`, настроить статические IP-адреса в частной сети, обеспечить доступ в интернет через шлюз.  

---

### Методические сведения  
1. **Частные подсети**  
   Частные IP-адреса (серые) используются в локальных сетях и не маршрутизируются в интернете. Примеры диапазонов:  
   - `10.0.0.0/8`  
   - `172.16.0.0/12`  
   - `192.168.0.0/16`  

2. **etcnet**  
   Etcnet
Более подробно про настройку сети с помощью Etcnet можно почитать тут.

Настройки сети могут изменяться либо в ЦУС (модуль Ethernet-интерфейсы), либо напрямую через редактирование файлов /etc/net/ifaces/<интерфейс>.

Файлы настройки сети для интерфейса enp0s3:

```bash
 ls -1 /etc/net/ifaces/enp0s3
```
ipv4address
ipv4route
options
resolv.conf
где:

файл ipv4address — содержит IP-адрес с длиной маски;
файл ipv4route — содержит маршрут по умолчанию;
файл options — содержит настройки конфигурации;
файл resolv.conf — содержит DNS-сервер.
Пример содержимого файла /etc/net/ifaces/enp0s3/options:

BOOTPROTO=dhcp
TYPE=eth
NM_CONTROLLED=no
DISABLED=no
CONFIG_WIRELESS=no
SYSTEMD_BOOTPROTO=dhcp4
CONFIG_IPV4=yes
SYSTEMD_CONTROLLED=no
ONBOOT=yes
CONFIG_IPV6=no
Параметр BOOTPROTO отвечает за способ получения сетевой картой сетевого адреса и может принимать значения:

static — адреса и маршруты будут взяты из файлов ipv4address и ipv4route;
dhcp — интерфейс будет сконфигурирован по DHCP;
ipv4ll — интерфейс будет сконфигурирован с помощью IPv4LL (link-local). Это значит, что из сети 169.254.0.0/16 (169.254.0.1-169.254.255.254) будет подобран ещё не использованный адрес и назначен на интерфейс.
Для настройки статического IP-адреса для интерфейса enp0s3 необходимо изменить запись BOOTPROTO=dhcp на BOOTPROTO=static в файле /etc/net/ifaces/enp0s3/option.

Затем нужно задать IP-адрес и маску сети, например 192.168.0.48/255.255.255.0, для этого в файл /etc/net/ifaces/enp0s3/ipv4address запишем параметры соединения:

```bash
 echo 192.168.0.48/24 > /etc/net/ifaces/enp0s3/ipv4address
```
Примечание: Если файл не существовал, он будет создан, иначе — его содержимое будет перезаписано.

Если сетевая карта предполагает наличие двух IP-адресов, то в файл ipv4address следует добавить ещё один адрес (обратите внимание на то, что используется ">>" вместо ">"; с ">" файл перезапишется, с ">>" вывод предыдущей команды будет дописан в конец файла):

```bash
 echo 192.168.0.148/24 >> /etc/net/ifaces/enp0s3/ipv4address
```
Далее запишем в файл /etc/net/ifaces/enp0s3/ipv4route имя шлюза по умолчанию (например, 192.168.0.1):

```bash
 echo default via 192.168.0.1 > /etc/net/ifaces/enp0s3/ipv4route
```
Если необходимо, можно создать файл с описанием dns-сервера /etc/net/ifaces/enp0s3/resolv.conf:

```bash
 echo nameserver 192.168.0.9 > /etc/net/ifaces/enp0s3/resolv.conf
```
Если у вас два dns (второй, например, 192.168.1.9), то его описание также нужно добавить в этот файл:

```bash
 echo nameserver 192.168.1.9 >> /etc/net/ifaces/enp0s3/resolv.conf
```
Для применения настроек необходимо перезапустить сеть:

```bash
 systemctl restart network
```
IP-адрес, маску и шлюз можно изменить командами ip addr {add|change|replace|del } … и ip route {add|del|change|append|replace} …. Например:

```bash
 ip addr add 192.168.0.140/24 dev enp0s3
```
```bash
 ip route add dev enp0s3 192.168.0.240
```
Однако эти команды изменяют конфигурацию сети до ближайшей перезагрузки компьютера. Для постоянного изменения нужно отредактировать файлы, о которых говорилось выше.

3. **NetworkManager (nmcli)**  
   Утилита командной строки для управления сетевыми подключениями. Позволяет настраивать интерфейсы, маршруты и DNS.  

4. **NAT (Network Address Translation)**  
   Технология, позволяющая локальной сети использовать один публичный IP для доступа в интернет. Настройка выполняется через `iptables`.  

---

### Задания для выполнения  

#### Часть 1: Настройка сетевого интерфейса на vm1 (ALT Server) через etcnet  
**Задача:** Назначить статический IP для внутреннего интерфейса и настроить NAT для доступа в интернет.  

1. **Определите интерфейсы на vm1**  
   ```bash
   ip a
   ```  
   - Интерфейс, подключенный к интернету: `eth0` (пример).  
   - Внутренний интерфейс: `eth1` (пример).  

2. **Настройка внутреннего интерфейса `eth1`**  
   - Создайте конфигурационные файлы:  
     ```bash
     touch /etc/net/ifaces/eth1/ipv4address
     echo "192.168.1.1/24" > /etc/net/ifaces/eth1/ipv4address
     ```  
   - Включите интерфейс:  
     ```bash
     systemctl restart network
     ```  

3. **Настройка NAT на vm1**  
   - Включите маршрутизацию в `/etc/net/sysctl.conf`:  
     ```bash
     net.ipv4.ip_forward=1
     ```  
   - Примените изменения:  
     ```bash
     sysctl -p
     ```  
   - Настройте iptables для NAT:  
     ```bash
     iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
     ```  
   - Сохраните правила:  
     ```bash
     iptables-save -f /etc/sysconfig/iptables
     systemctl enable --now iptables
     ```  

---

#### Часть 2: Настройка сетевого интерфейса на vm2 (ALT Workstation) через nmcli  
**Задача:** Назначить статический IP и настроить шлюз для доступа в интернет.  

1. **Просмотрите активные подключения:**  
   ```bash
   nmcli con show
   ```  
   Запишите имя подключения для внутреннего интерфейса (например, `eth0`).  

2. **Настройте статический IP через nmcli:**  
   ```bash
   nmcli con mod <имя_подключения> \
     ipv4.addresses 192.168.1.2/24 \
     ipv4.gateway 192.168.1.1 \
     ipv4.dns 8.8.8.8 \
     ipv4.method manual
   ```  

3. **Перезапустите подключение:**  
   ```bash
   nmcli con down <имя_подключения> && nmcli con up <имя_подключения>
   ```  

---

#### Часть 3: Проверка работоспособности  
1. **Проверьте связь между машинами:**  
   - С vm2:  
     ```bash
     ping 192.168.1.1
     ```  
   - С vm1:  
     ```bash
     ping 192.168.1.2
     ```  

2. **Проверьте доступ в интернет с vm2:**  
   ```bash
   ping 8.8.8.8
   curl google.com
   ```  

3. **Проверьте таблицу маршрутизации на vm2:**  
   ```bash
   ip route
   ```  
   Убедитесь, что шлюзом по умолчанию указан `192.168.1.1`.  

---

### Контрольные вопросы  
1. Какие преимущества имеет статическая адресация перед динамической?  
2. Для чего используется NAT в данной конфигурации?  
3. Как проверить таблицу маршрутизации на vm2?  
4. Какая команда позволяет просмотреть активные сетевые подключения через `nmcli`?  
5. Где хранятся конфигурации NetworkManager?  
6. Как перезагрузить сетевой интерфейс через `nmcli`?  
7. Что такое IP-маскарадинг и как он реализуется в `iptables`?  
8. Как изменить DNS-сервер для подключения через `nmcli`?  
9. Как проверить статус сетевого интерфейса в ALT Linux?  
10. Что произойдет, если не включить IP-форвардинг на vm1?
11. Какие параметры содержит файл options?
12. Какие файлы отвечают за IP-адрес при использовании etcnet?

---

**Примечание:** Все изменения сохраняются после перезагрузки. Для автоматического применения iptables добавьте скрипт в автозагрузку (например, через `/etc/rc.local`).
