### Лабораторная работа: Создание дисковых массивов с помощью `mdadm` на физических (виртуальных) дисках

---

#### **Цель работы:**
Изучить процесс создания программных RAID-массивов (Redundant Array of Independent Disks) с использованием утилиты `mdadm` в операционной системе Linux. Освоить основные команды для создания, управления и мониторинга RAID-массивов на физических или виртуальных дисках.

---

#### **Теоретическая часть:**

**RAID (Redundant Array of Independent Disks)** — это технология объединения нескольких физических дисков в один логический массив для повышения производительности, отказоустойчивости или увеличения объема хранилища.

**Основные уровни RAID:**
1. **RAID 0** — чередование данных (striping). Повышает производительность, но не обеспечивает отказоустойчивость.
2. **RAID 1** — зеркало (mirroring). Обеспечивает отказоустойчивость за счет дублирования данных.
3. **RAID 5** — распределение данных с контрольными суммами (parity). Обеспечивает баланс между производительностью и отказоустойчивостью.
4. **RAID 6** — расширенный вариант RAID 5 с двумя контрольными суммами.
5. **RAID 10** — комбинация RAID 1 и RAID 0 (зеркало + чередование).

**Утилита `mdadm`:**
- `mdadm` — это инструмент командной строки для управления программными RAID-массивами в Linux.
- Используется для создания, мониторинга, добавления/удаления дисков, восстановления массивов и других операций.

---

#### **Практическая часть:**

##### **Подготовка к работе:**

1. **Создание виртуальной машины (ВМ):**
   - Убедитесь, что у вас есть доступ к гипервизору (например, VirtualBox, VMware или KVM).
   - Создайте виртуальную машину с операционной системой Linux (например, Ubuntu Server).
   - При создании ВМ добавьте несколько дополнительных виртуальных жестких дисков (например, 4 диска по 1 ГБ каждый). Эти диски будут использоваться для создания RAID-массивов.

2. **Проверка доступных дисков:**
   После запуска ВМ проверьте, что все виртуальные диски доступны:
   ```bash
   lsblk
   ```
   Пример вывода:
   ```
   NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
   sda           8:0    0   20G  0 disk /
   sdb           8:16   0    1G  0 disk 
   sdc           8:32   0    1G  0 disk 
   sdd           8:48   0    1G  0 disk 
   sde           8:64   0    1G  0 disk 
   ```

---

##### **Задание 1: Создание RAID 0**

1. Создайте RAID 0 массив из двух дисков:
   ```bash
   mdadm --create --verbose /dev/md0 --level=0 --raid-devices=2 /dev/sdb /dev/sdc
   ```

2. Проверьте состояние массива:
   ```bash
   cat /proc/mdstat
   mdadm --detail /dev/md0
   ```

3. Создайте файловую систему на массиве:
   ```bash
   mkfs.ext4 /dev/md0
   ```

4. Смонтируйте массив:
   ```bash
   mkdir /mnt/raid0
   mount /dev/md0 /mnt/raid0
   ```

5. Проверьте доступность массива:
   ```bash
   df -h
   ```

6. Размонтируйте массив:
   ```bash
   umount /mnt/raid0
   ```

---

##### **Задание 2: Создание RAID 1**

1. Создайте RAID 1 массив из двух дисков:
   ```bash
   mdadm --create --verbose /dev/md1 --level=1 --raid-devices=2 /dev/sdd /dev/sde
   ```

2. Проверьте состояние массива:
   ```bash
   cat /proc/mdstat
   mdadm --detail /dev/md1
   ```

3. Дождитесь завершения синхронизации (если требуется).

4. Создайте файловую систему и смонтируйте массив:
   ```bash
   mkfs.ext4 /dev/md1
   mkdir /mnt/raid1
   mount /dev/md1 /mnt/raid1
   ```

5. Проверьте работу массива, создав тестовый файл:
   ```bash
   echo "Test file" | sudo tee /mnt/raid1/test.txt
   cat /mnt/raid1/test.txt
   ```

---

##### **Задание 3: Удаление RAID-массива**

1. Размонтируйте массив:
   ```bash
   umount /mnt/raid1
   ```

2. Остановите массив:
   ```bash
   mdadm --stop /dev/md1
   ```

3. Удалите метаданные RAID:
   ```bash
   mdadm --zero-superblock /dev/sdd
   mdadm --zero-superblock /dev/sde
   ```

---

##### **Задание 4: Мониторинг и восстановление RAID**

1. Создайте новый RAID 1 массив:
   ```bash
   mdadm --create --verbose /dev/md2 --level=1 --raid-devices=2 /dev/sdb /dev/sdc
   ```

2. Проверьте состояние массива:
   ```bash
   mdadm --detail /dev/md2
   ```

3. Отключите одно из устройств (симуляция сбоя):
   ```bash
   mdadm /dev/md2 --fail /dev/sdc
   mdadm /dev/md2 --remove /dev/sdc
   ```

4. Проверьте состояние массива:
   ```bash
   cat /proc/mdstat
   mdadm --detail /dev/md2
   ```

5. Добавьте новое устройство для восстановления:
   ```bash
   mdadm /dev/md2 --add /dev/sdc
   ```

6. Наблюдайте за процессом восстановления:
   ```bash
   watch cat /proc/mdstat
   ```

---

#### **Контрольные вопросы:**

1. Что такое RAID и какие преимущества он предоставляет?
2. Какие уровни RAID поддерживаются утилитой `mdadm`?
3. В чем разница между RAID 0 и RAID 1?
4. Как проверить состояние RAID-массива?
5. Как восстановить RAID-массив после сбоя одного из дисков?

---

#### **Вывод:**
В ходе лабораторной работы вы освоили процесс создания, управления и восстановления RAID-массивов с помощью утилиты `mdadm`. Вы научились работать с различными уровнями RAID на физических (или виртуальных) дисках и поняли принципы их функционирования.

---

**Примечание:** После завершения работы удалите все созданные RAID-массивы и очистите метаданные:
```bash
mdadm --stop /dev/md0
mdadm --stop /dev/md1
mdadm --stop /dev/md2
mdadm --zero-superblock /dev/sdb /dev/sdc /dev/sdd /dev/sde
```
